# HTML
# Archive your static HTML project and save it with the build record.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(build.sourcesDirectory)'
    includeRootFolder: false
- task: PublishBuildArtifacts@1
- task: CopyFilesOverSSH@0
  inputs:
    sshEndpoint: 'DevServer'
    sourceFolder: '$(build.sourcesDirectory)'
    contents: '**'
    targetFolder: '/deploy'
    readyTimeout: '20000'
- task: SSH@0
  inputs:
    sshEndpoint: 'DevServer'
    runOptions: 'commands'
    commands: |
      cd /var/www/
      sudo rm -rf html
      cd /var/www/deployments/
      sudo mkdir Dev-$(Build.BuildId)
      sudo cp /deploy/* -d /var/www/deployments/Dev-$(Build.BuildId)
      cd /var/www/
      sudo ln -s deployments/Dev-$(Build.BuildId) html
    readyTimeout: '20000'