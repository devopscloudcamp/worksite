# HTML
# Archive your static HTML project and save it with the build record.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(build.sourcesDirectory)'
    includeRootFolder: false
- task: PublishBuildArtifacts@1
- task: CopyFilesOverSSH@0
  inputs:
    sshEndpoint: 'DevServer'
    sourceFolder: '$(build.sourcesDirectory)'
    contents: '**'
    targetFolder: '/deploy'
    readyTimeout: '20000'
- task: SSH@0
  inputs:
    sshEndpoint: 'DevServer'
    runOptions: 'commands'
    commands: |
      #Unit Testing
      echo "unit testing started"
      if grep 'Fatel' /deploy/index.php; then
      echo "Test is failed in following number of line"
      sed -n '/Fatel/=' /deploy/index.html
      exit 1
      fi
      echo "Test is Successful"
    failOnStdErr: false
    readyTimeout: '200'